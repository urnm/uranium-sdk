# @uranium/sdk

Core SDK for the Uranium NFT platform. Provides a type-safe, feature-rich client for interacting with the Uranium API.

## Installation

```bash
bun add @uranium/sdk
```

## Features

- **Type-safe API Client**: Full TypeScript support with comprehensive type definitions
- **Modular Router Architecture**: Organized API endpoints (account, contracts, assets)
- **File Upload System**: Built-in upload manager with progress tracking and automatic retries
- **Zod Validation**: Request/response validation with detailed error messages
- **Automatic Retry Logic**: Configurable retry mechanism for failed requests
- **Device Management**: Automatic device ID generation and tracking
- **Error Handling**: Custom error classes with detailed context
- **Timeout Configuration**: Customizable request timeouts
- **Debug Mode**: Optional logging for development

## Quick Start

```typescript
import { UraniumSDK } from "@uranium/sdk";

// Initialize the SDK
const sdk = new UraniumSDK({
  apiKey: "your-api-key", // Get from https://portal.uranium.pro/dashboard/profile/api-keys
});

// Fetch user account
const user = await sdk.account.getMe("device-id");

// List collections
const collections = await sdk.contracts.list();

// List assets
const assets = await sdk.assets.list({
  contractId: "collection-id",
  page: 1,
  pageSize: 20,
});

// Upload and mint NFT
const asset = await sdk.upload.upload(file, {
  contractId: "collection-id",
  metadata: {
    title: "My NFT",
    description: "Amazing artwork",
  },
  editions: 1,
  onProgress: (progress) => {
    console.log(`${progress.stage}: ${progress.percent}%`);
  },
});
```

## Main Exports

### UraniumSDK Class

The main SDK class providing access to all API routers and upload functionality.

```typescript
const sdk = new UraniumSDK({ apiKey: "your-api-key" });
```

### Routers

- `sdk.account` - Account management (getMe)
- `sdk.contracts` - Collection management (list, create)
- `sdk.assets` - Asset management (list, create, get, update)
- `sdk.upload` - Upload and minting operations

### Utilities

```typescript
import {
  createApiClient,
  createApiRouters,
  generateDeviceId,
  getErrorMessage,
  isAxiosError,
  shouldRetry,
  withRetry,
  DeviceManager,
} from "@uranium/sdk";
```

### Types

All TypeScript types are exported for advanced usage:

```typescript
import type {
  UraniumConfig,
  RetryConfig,
  UserEntity,
  ContractEntity,
  AssetEntity,
  UploadOptions,
  UploadProgress,
  PaginatedResponse,
} from "@uranium/sdk";
```

## API Overview

### Account Router

```typescript
// Get current user information
const user = await sdk.account.getMe("device-id");
```

### Contracts Router

```typescript
// List all collections
const collections = await sdk.contracts.list();

// Create a new collection
const collection = await sdk.contracts.create({
  name: "My NFT Collection",
  symbol: "MNFT",
  type: "ERC721", // or "ERC1155"
});
```

### Assets Router

```typescript
// List assets with pagination
const response = await sdk.assets.list({
  contractId: "collection-id",
  page: 1,
  pageSize: 20,
  sortBy: "createdAt",
  order: "desc",
  quickFilter: "search term",
});

// Get single asset
const asset = await sdk.assets.get("asset-id");

// Create asset metadata
const asset = await sdk.assets.create({
  contractId: "collection-id",
  title: "My NFT",
  description: "Description",
  editions: 1,
});

// Update asset
const updated = await sdk.assets.update("asset-id", {
  title: "Updated Title",
});
```

### Upload Manager

```typescript
// Upload file and mint NFT
const asset = await sdk.upload.upload(file, {
  contractId: "collection-id",
  metadata: {
    title: "My NFT",
    description: "Description",
    location: "Optional location",
  },
  editions: 1,
  shareWithCommunity: false,
  onProgress: (progress) => {
    console.log(`Stage: ${progress.stage}`); // Client-side stage: VALIDATING, PREPARING, PROCESSING, UPLOADING, FINALIZING, REQUESTING_MINT, DONE
    console.log(`Progress: ${progress.percent}%`); // 0-100
    console.log(`Status: ${progress.currentStatus}`);

    // During UPLOADING stage, track individual chunk progress
    if (progress.stage === 'UPLOADING' && progress.chunkProgress !== undefined) {
      console.log(`Chunk progress: ${progress.chunkProgress}%`);
    }
  },
});
```

## Configuration Options

```typescript
const sdk = new UraniumSDK({
  // Required
  apiKey: "your-api-key",

  // Optional
  baseUrl: "https://gw.urnm.pro", // Default API base URL
  timeout: 20000, // Request timeout in milliseconds (default: 20000)
  deviceId: "custom-device-id", // Custom device ID (auto-generated by default)
  debug: false, // Enable debug logging (default: false)

  // Retry configuration
  retry: {
    enabled: false, // Enable retry mechanism (default: false)
    maxRetries: 3, // Maximum retry attempts (default: 3)
    retryDelay: 1000, // Initial delay between retries in ms (default: 1000)
    retryableStatuses: [500, 502, 503, 504], // HTTP status codes to retry
    onRetry: (attempt, error, delayMs) => {
      console.log(`Retry attempt ${attempt} after ${delayMs}ms`);
    },
  },
});
```

## Error Handling

The SDK uses custom error classes from `@uranium/types`:

```typescript
import {
  UraniumError,
  AuthenticationError,
  ValidationError,
  NetworkError,
  NotFoundError,
  UploadError,
  isUraniumError,
  isRetryableError,
} from "@uranium/sdk";

try {
  const user = await sdk.account.getMe("device-id");
} catch (error) {
  if (isUraniumError(error)) {
    console.error(`Error ${error.code}: ${error.message}`);
    console.error("Status:", error.statusCode);
    console.error("Context:", error.context);
  }
}
```

## Advanced Usage

### Low-Level API

For advanced users who need more control:

```typescript
import { createApiRouters } from '@uranium/sdk';

const api = createApiRouters({
  apiKey: 'your-api-key',
  timeout: 30000
});

await api.contracts.list();
```

### Custom Axios Client

```typescript
import { createApiClient, createApiRoutersFromClient } from '@uranium/sdk';

const customClient = createApiClient({
  apiKey: 'your-api-key',
  timeout: 30000,
  baseUrl: 'https://gw.urnm.pro'
});

const api = createApiRoutersFromClient(customClient);
```

## Documentation

For detailed usage examples, see the repository documentation.

## Build Information

- **Format**: ESM and CommonJS
- **TypeScript**: Full type declarations included
- **Target**: Node.js
- **Dependencies**: axios, zod, @uranium/types

## Development

```bash
# Install dependencies
bun install

# Build the package
bun run build

# Run tests
bun test

# Development mode with watch
bun run dev
```

## License

Apache 2.0

See [LICENSE](../../LICENSE) in the repository root for full license text.
